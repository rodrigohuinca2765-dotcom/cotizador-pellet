<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Cotizador Pellet + IA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
    }
    .box {
      margin-top: 15px;
      padding: 15px;
      border: 1px solid #ddd;
    }
    .precio {
      font-weight: bold;
      margin-bottom: 10px;
    }
    pre {
      white-space: pre-wrap;
    }
  </style>
</head>

<body>

  <h2>üî• Cotizador Pellet con IA</h2>

  <label>Cantidad de sacos:</label><br />
  <input type="number" id="cantidad" min="1" placeholder="Ej: 20" />
  <button onclick="cotizar()">Cotizar</button>

  <div id="resultado" class="box" style="display:none;">
    <div class="precio" id="precio"></div>
    <pre id="mensajeIA">Consultando IA...</pre>
    <br />
    <button onclick="enviarWhatsApp()">üì± Enviar a WhatsApp</button>
  </div>

  <script>
    const API_IA = "http://127.0.0.1:8000/ia"; // API IA (local o futura)

    let mensajeFinal = "";

    async function cotizar() {
      const cantidad = parseInt(document.getElementById("cantidad").value);
      if (!cantidad || cantidad <= 0) {
        alert("Ingresa una cantidad v√°lida");
        return;
      }

      let precioSaco = cantidad >= 60 ? 4240 : 4990;
      let total = cantidad * precioSaco;

      document.getElementById("resultado").style.display = "block";
      document.getElementById("precio").innerText =
        `üí∞ Precio por saco: $${precioSaco.toLocaleString()} | Total: $${total.toLocaleString()}`;

      // Mensaje base
      mensajeFinal =
        `Hola üëã\n` +
        `Acabo de cotizar pellet en Coyhaique.\n\n` +
        `üì¶ Cantidad: ${cantidad} sacos\n` +
        `üí∞ Precio por saco: $${precioSaco.toLocaleString()}\n` +
        `üßæ Total estimado: $${total.toLocaleString()}\n\n`;

      try {
        const resp = await fetch(API_IA, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ cantidad })
        });

        const data = await resp.json();
        mensajeFinal += data.respuesta;

        document.getElementById("mensajeIA").innerText = data.respuesta;

      } catch (error) {
        document.getElementById("mensajeIA").innerText =
          "‚ö†Ô∏è No se pudo contactar a la IA, pero la cotizaci√≥n est√° lista.";
      }
    }

    function enviarWhatsApp() {
      const numero = "56991422163"; // WhatsApp Business Ecomas
      const mensajeCodificado = encodeURIComponent(mensajeFinal);
      const url = `https://wa.me/${numero}?text=${mensajeCodificado}`;
      window.open(url, "_blank");
    }
  </script>

</body>
</html>
